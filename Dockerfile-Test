# Set the base image to Ubuntu
FROM continuumio/miniconda3

COPY requirements.txt requirements.txt

RUN pip install --upgrade pip && \
    conda update -y conda && \
    conda install -y nomkl pandas=0.21.0 requests && \
    pip install --no-cache-dir  -r requirements.txt && rm requirements.txt && \
    conda clean -y --all && \
    pip install --no-cache-dir httpretty pytest pytest-cov pytest-html sphinx

COPY ./pyutil          /pyutil/pyutil
COPY ./test            /pyutil/test

WORKDIR pyutil

CMD py.test --cov=pyutil  --cov-report html:/html-coverage --cov-report term --html=/html-report/report.html test
